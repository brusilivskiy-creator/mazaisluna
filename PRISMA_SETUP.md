# Настройка Prisma Remote базы данных

Это руководство поможет вам настроить полноценную базу данных для проекта Mazais с использованием Prisma Remote.

## Шаги настройки

### 1. Создание базы данных в Prisma Remote

У вас есть несколько вариантов:

#### Вариант A: Через Prisma Remote MCP (рекомендуется)

Если у вас настроен Prisma Remote MCP, вы можете создать базу данных через него. База данных будет создана автоматически при первом подключении.

#### Вариант B: Через Prisma Console

1. Перейдите на [console.prisma.io](https://console.prisma.io)
2. Войдите в свой аккаунт
3. Создайте новый проект "mazais"
4. Выберите регион (рекомендуется: `eu-central-1`)
5. Скопируйте connection string

### 2. Настройка переменных окружения

Создайте файл `.env` в корне проекта (если его еще нет) и добавьте:

```env
DATABASE_URL="your-prisma-connection-string-here"
```

**Важно:** Замените `your-prisma-connection-string-here` на реальный connection string из Prisma Remote.

### 3. Генерация Prisma Client

После настройки `DATABASE_URL`, выполните:

```bash
npm run db:generate
```

Эта команда сгенерирует Prisma Client на основе вашей схемы.

### 4. Применение схемы к базе данных

Выберите один из вариантов:

#### Вариант A: Быстрое применение (для разработки)

```bash
npm run db:push
```

Эта команда применит схему напрямую к базе данных без создания миграций.

#### Вариант B: С миграциями (для продакшена)

```bash
npm run db:migrate
```

Эта команда создаст миграцию и применит её к базе данных. Вам будет предложено ввести имя миграции (например: `init`).

### 5. Заполнение базы данных данными

После применения схемы, заполните базу данных данными из JSON файлов:

```bash
npm run db:seed
```

Эта команда:
- Очистит существующие данные
- Загрузит все данные из папки `data/`
- Создаст связи между моделями

### 6. Проверка данных (опционально)

Откройте Prisma Studio для визуального просмотра данных:

```bash
npm run db:studio
```

Откроется веб-интерфейс на `http://localhost:5555`, где вы сможете просматривать и редактировать данные.

## Доступные команды

- `npm run db:generate` - Генерация Prisma Client
- `npm run db:push` - Применение схемы без миграций (для разработки)
- `npm run db:migrate` - Создание и применение миграций
- `npm run db:seed` - Заполнение базы данных данными
- `npm run db:studio` - Открытие Prisma Studio

## Структура базы данных

База данных включает следующие модели:

- **Category** - Категории новостей и навигации
- **News** - Новости
- **Party** - Политические партии
- **Politician** - Политики
- **Position** - Должности
- **Leadership** - Связь политиков с должностями
- **Parliament** - Парламентские выборы
- **ParliamentResult** - Результаты партий на выборах
- **MajoritarianDistrict** - Мажоритарные округи
- **LeaderElection** - Выборы лидера
- **LeaderElectionResult** - Результаты выборов лидера

## Миграция с JSON на базу данных

После настройки базы данных, вам нужно будет обновить API routes в `app/api/` для использования Prisma Client вместо файловой системы. Это можно сделать постепенно, начиная с самых важных endpoints.

## Troubleshooting

### Ошибка подключения к базе данных

- Проверьте, что `DATABASE_URL` правильно установлен в `.env`
- Убедитесь, что connection string из Prisma Remote скопирован полностью
- Проверьте, что база данных создана и активна в Prisma Console

### Ошибки при seed

- Убедитесь, что все JSON файлы в папке `data/` существуют и валидны
- Проверьте, что схема применена к базе данных (`npm run db:push`)

### Проблемы с типами

- Выполните `npm run db:generate` после изменения схемы
- Перезапустите TypeScript сервер в вашем редакторе

## Следующие шаги

После успешной настройки базы данных:

1. Обновите API routes для использования Prisma Client
2. Добавьте валидацию данных с помощью Zod
3. Настройте индексы для оптимизации запросов
4. Добавьте кэширование для часто запрашиваемых данных

